# FastAPI Calculator

### **JWT Authentication + Front-End Pages + Playwright E2E + CI/CD + Docker Hub Deployment**

This project implements a fully authenticated FastAPI application with **JWT login/registration**, **client-side validated frontend pages**, **Playwright E2E tests**, and a complete **CI/CD pipeline** that builds and deploys Docker images to **Docker Hub** on each successful commit.

---

# Module-13 Features Completed

- ✔ **JWT-based user registration & login**
- ✔ **Password hashing + Pydantic validation**
- ✔ **Frontend pages** (`/register`, `/login`) with **JavaScript client-side validation**
- ✔ **Stores JWT in localStorage on successful login**
- ✔ **Playwright E2E tests (positive + negative cases)**
- ✔ **CI/CD GitHub Actions workflow**

Test status (local): `54 passed, 1 skipped` (unit + integration + e2e) — verified 2025-12-07.

- Spins up Postgres + server
- Runs unit + integration tests
- Runs Playwright E2E tests
- Builds & pushes Docker image to Docker Hub

- ✔ **Docker Compose for local development**
- ✔ **Swagger UI testing with Bearer token**
- ✔ **Calculator BREAD routes protected by JWT**

---

# **Repository & Docker Hub Links**

| Resource             | Link                                                                                                     |
| -------------------- | -------------------------------------------------------------------------------------------------------- |
| **GitHub Repo**      | [https://github.com/shanmukh1315/fastapi_calculator](https://github.com/shanmukh1315/fastapi_calculator) |
| **Docker Hub Image** | https://hub.docker.com/repository/docker/shanmukha1315/fastapi_calculator/general                        |
| **Local App URL**    | [http://127.0.0.1:8000](http://127.0.0.1:8000)                                                           |
| **Swagger UI**       | [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)                                                 |
| **Register Page**    | [http://127.0.0.1:8000/register](http://127.0.0.1:8000/register)                                         |
| **Login Page**       | [http://127.0.0.1:8000/login](http://127.0.0.1:8000/login)                                               |

---

# Project Overview

A secure calculator web app with:

- User registration/login using JWT
- Client-side validated front-end templates
- Authenticated calculation BREAD API
- SQLAlchemy + PostgreSQL
- CI/CD + E2E testing
- Docker Hub publishing workflow

---

# **JWT Authentication Routes**

### **POST /register**

Body:

```json
{
  "email": "example@gmail.com",
  "username": "admin",
  "password": "secret123"
}
```

### **POST /login**

Returns:

```json
{
  "access_token": "<JWT>",
  "token_type": "bearer"
}
```

Swagger UI lets you click **Authorize → paste token** → now all protected endpoints work.

You already demonstrated it here:

- Create (POST `/api/calculations`):

```json
{
  "a": 10,
  "type": "add",
  "b": 5
}
```

- Browse (GET `/api/calculations`) — lists the authenticated user's calculations.
- Read (GET `/api/calculations/{id}`) — returns specific calculation if owned.
- Update (PUT `/api/calculations/{id}`) — modify fields and recompute result.
- Delete (DELETE `/api/calculations/{id}`) — remove calculation.

7. Curl examples (replace `localhost:8000` if running elsewhere):

```bash
# register
curl -s -X POST http://localhost:8000/api/users -H "Content-Type: application/json" -d '{"username":"alice","email":"alice@example.com","password":"secret123"}'

# login -> extract token (requires jq)
TOKEN=$(curl -s -X POST http://localhost:8000/api/users/login -H "Content-Type: application/json" -d '{"username":"alice","password":"secret123"}' | jq -r .access_token)

# create a calculation
curl -s -X POST http://localhost:8000/api/calculations -H "Content-Type: application/json" -H "Authorization: Bearer $TOKEN" -d '{"a":10,"type":"add","b":5}'

# list calculations
curl -s -X GET http://localhost:8000/api/calculations -H "Authorization: Bearer $TOKEN"

# get a calculation (id 1)
curl -s -X GET http://localhost:8000/api/calculations/1 -H "Authorization: Bearer $TOKEN"

# update calculation (id 1)
curl -s -X PUT http://localhost:8000/api/calculations/1 -H "Content-Type: application/json" -H "Authorization: Bearer $TOKEN" -d '{"a":20,"type":"add","b":5}'

# delete calculation (id 1)
curl -s -X DELETE http://localhost:8000/api/calculations/1 -H "Authorization: Bearer $TOKEN"
```

Notes:

- If you get `401 Unauthorized`, verify the `Authorization` header and that the token was generated by the running server (`SECRET_KEY` must match).
- If you get `403 Forbidden`, the authenticated user is not the owner of the requested calculation.

## Module 14 — BREAD for Calculations (what to submit)

Submission Checklist:

- Repository contains backend BREAD endpoints under `/api/calculations` (GET, POST, PUT, DELETE).
- Frontend page at `http://localhost:8000/calculations` for Browse/Add/Edit/Delete operations.
- Playwright E2E tests covering positive and negative scenarios located in `tests/e2e/`.
- README includes instructions to run the app, tests, and where the Docker image is pushed.

Quick steps to run locally for screenshots:

1. Start the app:

```bash
source .venv/bin/activate
uvicorn app.main:app --reload
```

2. Open the pages in a browser and capture screenshots:

- Registration page: `http://127.0.0.1:8000/register`
- Login page: `http://127.0.0.1:8000/login` (after login, `localStorage.getItem('token')` holds the access token)
- Calculations BREAD page: `http://127.0.0.1:8000/calculations` — create, edit, browse and delete calculations
  Swagger UI lets you click **Authorize → paste token** → now all protected endpoints work.

You can exercise the protected Calculator API as follows.

Create (POST `/api/calculations`):

```json
{
  "a": 10,
  "type": "add",
  "b": 5
}
```

Browse (GET `/api/calculations`) — lists the authenticated user's calculations.

Read (GET `/api/calculations/{id}`) — returns a specific calculation if owned.

Update (PUT `/api/calculations/{id}`) — modify fields and recompute result.

Delete (DELETE `/api/calculations/{id}`) — remove a calculation.

Curl examples (replace `localhost:8000` if running elsewhere):

```bash
# register
curl -s -X POST http://localhost:8000/api/users -H "Content-Type: application/json" -d '{"username":"alice","email":"alice@example.com","password":"secret123"}'

# login -> extract token (requires jq)
TOKEN=$(curl -s -X POST http://localhost:8000/api/users/login -H "Content-Type: application/json" -d '{"username":"alice","password":"secret123"}' | jq -r .access_token)

# create a calculation
curl -s -X POST http://localhost:8000/api/calculations -H "Content-Type: application/json" -H "Authorization: Bearer $TOKEN" -d '{"a":10,"type":"add","b":5}'

# list calculations
curl -s -X GET http://localhost:8000/api/calculations -H "Authorization: Bearer $TOKEN"

# get a calculation (id 1)
curl -s -X GET http://localhost:8000/api/calculations/1 -H "Authorization: Bearer $TOKEN"

# update calculation (id 1)
curl -s -X PUT http://localhost:8000/api/calculations/1 -H "Content-Type: application/json" -H "Authorization: Bearer $TOKEN" -d '{"a":20,"type":"add","b":5}'

# delete calculation (id 1)
curl -s -X DELETE http://localhost:8000/api/calculations/1 -H "Authorization: Bearer $TOKEN"
```

Notes:

- If you get `401 Unauthorized`, verify the `Authorization` header and that the token was generated by the running server (`SECRET_KEY` must match).
- If you get `403 Forbidden`, the authenticated user is not the owner of the requested calculation.

## Module 14 — BREAD for Calculations (what to submit)

Submission Checklist:

- Repository contains backend BREAD endpoints under `/api/calculations` (GET, POST, PUT, DELETE).
- Frontend page at `http://localhost:8000/calculations` for Browse/Add/Edit/Delete operations.
- Playwright E2E tests covering positive and negative scenarios located in `tests/e2e/`.
- README includes instructions to run the app, tests, and where the Docker image is pushed.

Quick steps to run locally for screenshots:

1. Start the app:

```bash
source .venv/bin/activate
uvicorn app.main:app --reload
```

2. Open the pages in a browser and capture screenshots:

- Registration page: `http://127.0.0.1:8000/register`
- Login page: `http://127.0.0.1:8000/login` (after login, `localStorage.getItem('token')` holds the access token)
- Calculations BREAD page: `http://127.0.0.1:8000/calculations` — create, edit, browse and delete calculations
- Swagger UI: `http://127.0.0.1:8000/docs` (show Authorize and protected endpoints)

3. Run Playwright tests (requires browsers installed):

```bash
playwright install chromium
pytest tests/e2e -q
```

4. Build and run Docker (if you want to verify the container):

```bash
docker compose up --build
```

If you want, I can also add a small `SUBMISSION_CHECKLIST.md` file to the repo with the exact screenshot names and commands.

## Docker & Deployment

Build and run locally with Docker Compose:

```bash
docker compose up --build
```

This starts:

| Service       | Port | Purpose        |
| ------------- | ---- | -------------- |
| `fastapi_app` | 8000 | API + Frontend |
| `postgres_db` | 5432 | Database       |
| `pgadmin`     | 5050 | Database UI    |

Environment variables are loaded from `.env`.

---

# Swagger BREAD API (Protected With JWT)

Must include:

```
Authorization: Bearer <token>
```

### Endpoints:

| Method | Route                    |
| ------ | ------------------------ |
| GET    | `/api/calculations`      |
| POST   | `/api/calculations`      |
| GET    | `/api/calculations/{id}` |
| PUT    | `/api/calculations/{id}` |
| DELETE | `/api/calculations/{id}` |

Your screenshots show:

- Creating a calculation works
- Reading works
- Unauthorized reads return 403 (correct behavior)

---

# Project Structure

```
fastapi_calculator/
├── app/
│   ├── main.py
│   ├── models.py
│   ├── schemas.py
│   ├── security.py
│   ├── users.py
│   ├── templates/
│   │   ├── register.html
│   │   └── login.html
│   └── calculation_factory.py
├── tests/
│   ├── unit/
│   ├── integration/
│   └── e2e/
├── .github/workflows/ci.yml
├── docker-compose.yml
├── Dockerfile
├── requirements.txt
└── README.md
```

Environment variables are loaded from `.env`.

---

# Swagger BREAD API (Protected With JWT)

Must include:

```
Authorization: Bearer <token>
```

### Endpoints:

| Method | Route                    |
| ------ | ------------------------ |
| GET    | `/api/calculations`      |
| POST   | `/api/calculations`      |
| GET    | `/api/calculations/{id}` |
| PUT    | `/api/calculations/{id}` |
| DELETE | `/api/calculations/{id}` |

Your screenshots show:

- Creating a calculation works
- Reading works
- Unauthorized reads return 403 (correct behavior)

---

# Project Structure

```
fastapi_calculator/
├── app/
│   ├── main.py
│   ├── models.py
│   ├── schemas.py
│   ├── security.py
│   ├── users.py
│   ├── templates/
│   │   ├── register.html
│   │   └── login.html
│   └── calculation_factory.py
├── tests/
│   ├── unit/
│   ├── integration/
│   └── e2e/
├── .github/workflows/ci.yml
├── docker-compose.yml
├── Dockerfile
├── requirements.txt
└── README.md
```
